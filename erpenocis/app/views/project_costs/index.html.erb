<h1>Costuri proiecte</h1>
<%= render 'layouts/date_form' %>
<br>
<table>
  <% max = 0 %>
  <% @projects.each do |project| %>
    <% (max<project.project_costs.length) ? max=project.project_costs.length : max %>
  <% end %>
  <thead>
    <tr>
      <th>ID</th>
      <th>Nume</th>
      <% max.times do |i| %>
        <th>Cost <%= i+1 %> </th>
        <th>Data cost <%= i+1 %> </th>
      <% end %>
      <th>Total</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  
  <tbody>
    <% @projects.each do |project| %>
      <tr>
        <td><%= project.id %></td>
        <td><%= project.name %></td>
        <% i=0 %>
        <% project.project_costs.each do |cost| %>
          <td>
            <%= cost.amount %>
          </td>
          <td>
            <% if cost.month&&cost.year %>
              <%= cost.month.to_s + " / " %>
              <%= cost.year %>
            <% end %>
          </td>
          <% i+=1 %>
        <% end %>
        <% if i<max %>
          <% (max*2-i*2).times do %>
            <td></td>
          <% end %>
        <% end %>
        <td><%= project.project_costs.map(&:amount).sum %></td>
        <td><%= link_to 'Modifica', edit_project_cost_path(project, sm: @start_month, sy: @start_year, em: @end_month, ey:@end_year
        ) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
